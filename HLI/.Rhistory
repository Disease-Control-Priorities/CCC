spread(year, Control)%>%
left_join(., pop)%>%
mutate(slope = (`2050` - `2022`)/(2050-2022))%>%
na.omit()%>%
summarise(rate = weighted.mean(slope, pop))
## Scenario 4
scenario4_PP<-cascade2%>%
left_join(.,aroc)%>%
merge(., data.frame(year=2017:2050))%>%
mutate(initiation_aroc = ifelse(initiation_aroc>0.005, 0.005, initiation_aroc),
adherence_aroc = ifelse(adherence_aroc>0.005, 0.005, adherence_aroc))%>%
mutate(Aware = ifelse(year<2023, pp_aware, 0.95 - (0.95-pp_aware)*exp(-aware_aroc*(year-2022))), #log scale
Aware = ifelse(year<2023, pp_aware, Aware + (year-2022)*(aware_aroc+0.02)), #linear scale
Aware = ifelse(Aware>0.95, 0.95, Aware),
Initiation = ifelse(year<2023, pp_initiation, ((year-2022)*(initiation_aroc+0.02) + pp_initiation)),
Initiation = ifelse(Initiation>0.95 ,0.95, Initiation),
Treated = Aware * Initiation,
Adherence = ifelse(year<2023, pp_adherence, ((year-2022)*(adherence_aroc+0.02) + pp_adherence)),
Adherence = ifelse(Adherence>0.95 ,0.95, Adherence),
Control = Treated*Adherence)%>%
select(location_name, iso3, cause, year, Aware, Treated, Control, Initiation, Adherence)
scenario4_SP<-cascade2%>%
left_join(.,aroc)%>%
merge(., data.frame(year=2017:2050))%>%
mutate(initiation_aroc = ifelse(initiation_aroc>0.005, 0.005, initiation_aroc),
adherence_aroc = ifelse(adherence_aroc>0.005, 0.005, adherence_aroc))%>%
mutate(Aware = ifelse(year<2023, sp_aware, 0.95 - (0.95-sp_aware)*exp(-aware_aroc*(year-2022))), #log scale
Aware = ifelse(year<2023, sp_aware, Aware + (year-2022)*(aware_aroc+0.02)), #linear scale
Aware = ifelse(Aware>0.95, 0.95, Aware),
Initiation = ifelse(year<2023, sp_initiation, ((year-2022)*(initiation_aroc+0.02) + sp_initiation)),
Initiation = ifelse(Initiation>0.95 ,0.95, Initiation),
Treated = Aware * Initiation,
Adherence = ifelse(year<2023, sp_adherence, ((year-2022)*(adherence_aroc+0.02) + sp_adherence)),
Adherence = ifelse(Adherence>0.95 ,0.95, Adherence),
Control = Treated*Adherence)%>%
select(location_name, iso3, cause, year, Aware, Treated, Control, Initiation, Adherence)
scenario4_PP_asp<-cascade3%>%
left_join(.,aroc)%>%
merge(., data.frame(year=2017:2050))%>%
mutate(initiation_aroc = ifelse(initiation_aroc>0.005, 0.005, initiation_aroc),
adherence_aroc = ifelse(adherence_aroc>0.005, 0.005, adherence_aroc))%>%
mutate(Aware = ifelse(year<2023, pp_aware, 0.95 - (0.95-pp_aware)*exp(-aware_aroc*(year-2022))), #log scale
Aware = ifelse(year<2023, pp_aware, Aware + (year-2022)*(aware_aroc+0.02)), #linear scale
Aware = ifelse(Aware>0.95, 0.95, Aware),
Initiation = ifelse(year<2023, pp_initiation, ((year-2022)*(initiation_aroc+0.02) + pp_initiation)),
Initiation = ifelse(Initiation>0.95 ,0.95, Initiation),
Treated = Aware * Initiation,
Adherence = ifelse(year<2023, pp_adherence, ((year-2022)*(adherence_aroc+0.02) + pp_adherence)),
Adherence = ifelse(Adherence>0.95 ,0.95, Adherence),
Control = Treated*Adherence)%>%
select(location_name, iso3, cause, year, Aware, Treated, Control, Initiation, Adherence)
scenario4_SP_asp<-cascade3%>%
left_join(.,aroc)%>%
merge(., data.frame(year=2017:2050))%>%
mutate(initiation_aroc = ifelse(initiation_aroc>0.005, 0.005, initiation_aroc),
adherence_aroc = ifelse(adherence_aroc>0.005, 0.005, adherence_aroc))%>%
mutate(Aware = ifelse(year<2023, sp_aware, 0.95 - (0.95-sp_aware)*exp(-aware_aroc*(year-2022))), #log scale
Aware = ifelse(year<2023, sp_aware, Aware + (year-2022)*(aware_aroc+0.02)), #linear scale
Aware = ifelse(Aware>0.95, 0.95, Aware),
Initiation = ifelse(year<2023, sp_initiation, ((year-2022)*(initiation_aroc+0.02) + sp_initiation)),
Initiation = ifelse(Initiation>0.95 ,0.95, Initiation),
Treated = Aware * Initiation,
Adherence = ifelse(year<2023, sp_adherence, ((year-2022)*(adherence_aroc+0.02) + sp_adherence)),
Adherence = ifelse(Adherence>0.95 ,0.95, Adherence),
Control = Treated*Adherence)%>%
select(location_name, iso3, cause, year, Aware, Treated, Control, Initiation, Adherence)
plot3<-bind_rows(baselinePP%>%mutate(scenario="baseline"),
scenario4_PP%>%mutate(scenario="scenario 4"))
ggplot(plot3, aes(x=year, y=Control, groups=location_name))+
geom_line()+
facet_grid(cause~scenario)
#average rate of scale up
scenario4_SP%>%filter(year %in% c(2022,2050))%>%
select(year, iso3, Control, cause)%>%
spread(year, Control)%>%
left_join(., pop)%>%
mutate(slope = (`2050` - `2022`)/(2050-2022))%>%
na.omit()%>%
summarise(rate = weighted.mean(slope, pop))
plot<-bind_rows(baselinePP%>%mutate(scenario="Baseline"),
scenario4_PP%>%mutate(scenario="Scenario 4"),
scenario1_PP%>%mutate(scenario="Scenario 1"),
scenario2_PP%>%mutate(scenario="Scenario 2"),
scenario3_PP%>%mutate(scenario="Scenario 3"))%>%
group_by(location_name, year, scenario)%>%
summarise(Control = mean(Control),
Treated = mean(Treated),
Aware = mean(Aware))
ggplot(plot, aes(x=year, y=Control, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0,1)+
xlab("Year")+
ylab("Primary prevention effective coverage")
ggsave("../outputs/new_coverage.jpeg", width=10, height=4)
ggplot(plot, aes(x=year, y=Treated, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0,1)+
xlab("Year")+
ylab("Primary prevention treatment coverage")
ggsave("../outputs/new_coverage_treated.jpeg", width=10, height=4)
ggplot(plot, aes(x=year, y=Aware, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0.2,1)+
xlab("Year")+
ylab("Primary prevention awareness")
ggsave("../outputs/new_coverage_aware.jpeg", width=10, height=4)
#cascade bar chart:
plot2<-plot%>%group_by(year,scenario)%>%
summarise(Control = mean(Control),
Treated = mean(Treated),
Aware = mean(Aware))%>%
gather(Metric, val, -year, -scenario)%>%
mutate(Metric = factor(Metric, levels=c("Aware", "Treated", "Control")),
scenario = factor(scenario, levels=c("Scenario 4", "Scenario 3", "Scenario 2", "Scenario 1", "Baseline")))
ggplot(plot2, aes(x=year, y=val, color=scenario))+
geom_line(size=1)+
facet_wrap(~Metric)+
ylab("Proportion of all primary prevention patients")+
xlab("Year")+
ylim(0,1)+
labs(color = "Scenario")+
theme_bw()
ggsave("../outputs/cascade.jpeg", height=4, width=8)
write.csv(plot, "../cascade_data_trt.csv", row.names = F)
#SP
plot<-bind_rows(baselineSP%>%mutate(scenario="Baseline"),
scenario4_SP%>%mutate(scenario="Scenario 4"),
scenario1_SP%>%mutate(scenario="Scenario 1"),
scenario2_SP%>%mutate(scenario="Scenario 2"),
scenario3_SP%>%mutate(scenario="Scenario 3"))%>%
group_by(location_name, year, scenario)%>%
summarise(Control = mean(Control),
Treated = mean(Treated),
Aware = mean(Aware))
ggplot(plot, aes(x=year, y=Control, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0,1)+
xlab("Year")+
ylab("Secondary prevention effective coverage")
ggsave("../outputs/new_coverage_SP.jpeg", width=10, height=4)
#put it in scale-up format
sup<-read.csv("../scale-up.csv", stringsAsFactors = F)
sup_aspirin<-read.csv("../scale-up_withaspirin.csv", stringsAsFactors = F)
cov<-bind_rows(baselinePP%>%mutate(intervention="Baseline"),
scenario4_PP%>%mutate(intervention="Scenario 4"),
scenario1_PP%>%mutate(intervention="Scenario 1"),
scenario2_PP%>%mutate(intervention="Scenario 2"),
scenario3_PP%>%mutate(intervention="Scenario 3"))%>%
select(location_name, iso3, cause, year, intervention,
pp_cov = Control, pp_trt = Treated)%>%
left_join(., bind_rows(baselineSP%>%mutate(intervention="Baseline"),
scenario4_SP%>%mutate(intervention="Scenario 4"),
scenario1_SP%>%mutate(intervention="Scenario 1"),
scenario2_SP%>%mutate(intervention="Scenario 2"),
scenario3_SP%>%mutate(intervention="Scenario 3"))%>%
select(location_name, iso3, cause, year, intervention,
sp_cov = Control, sp_trt = Treated)
)%>%left_join(., sup%>%select(-pp.cov.inc, -sp.cov.inc, -pp_cov, -sp_cov))%>%
group_by(intervention, location_name, cause)%>%
arrange(year, .by_group=TRUE)%>%
mutate(pp.cov.inc = pp_cov - shift(pp_cov),
pp.cov.inc = ifelse(is.na(pp.cov.inc), 0, pp.cov.inc),
pp.cov.inc = cumsum(pp.cov.inc),
sp.cov.inc = sp_cov - shift(sp_cov),
sp.cov.inc = ifelse(is.na(sp.cov.inc), 0, sp.cov.inc),
sp.cov.inc = cumsum(sp.cov.inc),
pp.trt.inc = pp_trt - shift(pp_trt),
pp.trt.inc = ifelse(is.na(pp.trt.inc), 0, pp.trt.inc),
pp.trt.inc = cumsum(pp.trt.inc),
sp.trt.inc = sp_trt - shift(sp_trt),
sp.trt.inc = ifelse(is.na(sp.trt.inc), 0, sp.trt.inc),
sp.trt.inc = cumsum(sp.trt.inc))
write.csv(cov, "../scale-up-new.csv", row.names = F)
cov2<-bind_rows(baselinePP_asp%>%mutate(intervention="Baseline"),
scenario4_PP_asp%>%mutate(intervention="Scenario 4"),
scenario1_PP_asp%>%mutate(intervention="Scenario 1"),
scenario2_PP_asp%>%mutate(intervention="Scenario 2"),
scenario3_PP_asp%>%mutate(intervention="Scenario 3"))%>%
select(location_name, iso3, cause, year, intervention,
pp_cov = Control, pp_trt = Treated)%>%
left_join(., bind_rows(baselineSP_asp%>%mutate(intervention="Baseline"),
scenario4_SP_asp%>%mutate(intervention="Scenario 4"),
scenario1_SP_asp%>%mutate(intervention="Scenario 1"),
scenario2_SP_asp%>%mutate(intervention="Scenario 2"),
scenario3_SP_asp%>%mutate(intervention="Scenario 3"))%>%
select(location_name, iso3, cause, year, intervention,
sp_cov = Control, sp_trt = Treated)
)%>%left_join(., sup_aspirin%>%select(-pp.cov.inc, -sp.cov.inc, -pp_cov, -sp_cov))%>%
group_by(intervention, location_name, cause)%>%
arrange(year, .by_group=TRUE)%>%
mutate(pp.cov.inc = pp_cov - shift(pp_cov),
pp.cov.inc = ifelse(is.na(pp.cov.inc), 0, pp.cov.inc),
pp.cov.inc = cumsum(pp.cov.inc),
sp.cov.inc = sp_cov - shift(sp_cov),
sp.cov.inc = ifelse(is.na(sp.cov.inc), 0, sp.cov.inc),
sp.cov.inc = cumsum(sp.cov.inc),
pp.trt.inc = pp_trt - shift(pp_trt),
pp.trt.inc = ifelse(is.na(pp.trt.inc), 0, pp.trt.inc),
pp.trt.inc = cumsum(pp.trt.inc),
sp.trt.inc = sp_trt - shift(sp_trt),
sp.trt.inc = ifelse(is.na(sp.trt.inc), 0, sp.trt.inc),
sp.trt.inc = cumsum(sp.trt.inc))
write.csv(cov2, "../scale-up-new-aspirin.csv", row.names = F)
ggplot(plot2, aes(x=year, y=val, color=scenario))+
geom_line(size=1)+
facet_wrap(~Metric)+
ylab("Proportion of all primary prevention patients")+
xlab("Year")+
ylim(0,1)+
labs(color = "Scenario")+
theme_bw()
View(plot)
write.csv(plot, "../shiny/FDC/cascade_data_trt.csv", row.names = F)
View(plot)
plot<-bind_rows(baselinePP%>%mutate(scenario="Baseline"),
scenario4_PP%>%mutate(scenario="Scenario 4"),
scenario1_PP%>%mutate(scenario="Scenario 1"),
scenario2_PP%>%mutate(scenario="Scenario 2"),
scenario3_PP%>%mutate(scenario="Scenario 3"))%>%
group_by(location_name, year, scenario)%>%
summarise(Control = mean(Control),
Treated = mean(Treated),
Aware = mean(Aware))
ggplot(plot, aes(x=year, y=Control, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0,1)+
xlab("Year")+
ylab("Primary prevention effective coverage")
ggsave("../outputs/new_coverage.jpeg", width=10, height=4)
ggplot(plot, aes(x=year, y=Treated, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0,1)+
xlab("Year")+
ylab("Primary prevention treatment coverage")
ggsave("../outputs/new_coverage_treated.jpeg", width=10, height=4)
ggplot(plot, aes(x=year, y=Aware, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0.2,1)+
xlab("Year")+
ylab("Primary prevention awareness")
ggsave("../outputs/new_coverage_aware.jpeg", width=10, height=4)
#cascade line plot:
plot2<-plot%>%group_by(year,scenario)%>%
summarise(Control = mean(Control),
Treated = mean(Treated),
Aware = mean(Aware))%>%
gather(Metric, val, -year, -scenario)%>%
mutate(Metric = factor(Metric, levels=c("Aware", "Treated", "Control")),
scenario = factor(scenario, levels=c("Scenario 4", "Scenario 3", "Scenario 2", "Scenario 1", "Baseline")))
ggplot(plot2, aes(x=year, y=val, color=scenario))+
geom_line(size=1)+
facet_wrap(~Metric)+
ylab("Proportion of all primary prevention patients")+
xlab("Year")+
ylim(0,1)+
labs(color = "Scenario")+
theme_bw()
ggsave("../outputs/cascade.jpeg", height=4, width=8)
write.csv(plot, "../cascade_data_trt.csv", row.names = F)
write.csv(plot, "../shiny/FDC/cascade_data_trt.csv", row.names = F)
#SP
plot<-bind_rows(baselineSP%>%mutate(scenario="Baseline"),
scenario4_SP%>%mutate(scenario="Scenario 4"),
scenario1_SP%>%mutate(scenario="Scenario 1"),
scenario2_SP%>%mutate(scenario="Scenario 2"),
scenario3_SP%>%mutate(scenario="Scenario 3"))%>%
group_by(location_name, year, scenario)%>%
summarise(Control = mean(Control),
Treated = mean(Treated),
Aware = mean(Aware))
ggplot(plot, aes(x=year, y=Control, groups=location_name))+
geom_line()+
facet_wrap(~scenario, nrow=1)+
ylim(0,1)+
xlab("Year")+
ylab("Secondary prevention effective coverage")
write.csv(plot, "../shiny/FDC/cascade_data_SP.csv", row.names = F)
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
runApp('C:/Users/sarah/OneDrive - UW/FDC/shiny/FDC')
rm(list=ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
pacman::p_load(data.table, dplyr, tidyr, stringr, ggplot2, tidyverse, broom, readxl)
'%!in%' <- function(x,y)!('%in%'(x,y)) # Function "Not In"
#intersectoral results#
load("../for_parallel_processing/output2050_target_intersectoral_ssb.Rda")
dadt.all2<-dadt.all
all.pin2<-all.pin
all.dalys2<-all.dalys
#exclude Panama and Romania as they are now HICs
#exclude Serbia
#should be 114
all.locs<-unique(all.pin$location_name[all.pin$location_name!="Romania" & all.pin$location_name!="Panama" & all.pin$location_name!="Serbia"])
#clinical results#
load(paste0("../for_parallel_processing/for_HLI/Afghanistan_output2050_target.Rda"))
clinical.dadt<-dadt.all
clinical.dalys<-all.dalys
clinical.pin<-all.pin
for(is in all.locs[2:114]){
load(paste0("../for_parallel_processing/for_HLI/", is,"_output2050_target.Rda"))
clinical.dadt<-bind_rows(clinical.dadt, dadt.all)
clinical.dalys<-bind_rows(clinical.dalys, all.dalys)
clinical.pin<-bind_rows(clinical.pin, all.pin)
}
######## Deaths averted ########
deaths.averted<-bind_rows(clinical.dadt, dadt.all2)%>%
filter(location_name!="Serbia")%>%
group_by(Code, year_id, location_name)%>%
summarise(
#Deaths.Baseline = sum(NCD.Deaths0),
#Deaths.Adjusted = sum(NCD.Deaths1),
Deaths.avert = sum(Deaths.Avert))%>%
mutate(year_id = as.numeric(year_id))
######## DALYs averted ########
dalys.averted<-bind_rows(clinical.dalys, all.dalys2)%>%
filter(location_name!="Serbia")%>%
group_by(Code, year_id, location_name)%>%
summarise(DALYS.Adjusted = sum(Adjusted),
DALYS.Baseline = sum(Baseline),
DALYS.avert = sum(DALY.ave),
DALYS.avert =ifelse(DALYS.avert<1, 0, DALYS.avert))%>%
mutate(year_id = as.numeric(year_id))
######## PIN ########
pin<-bind_rows(clinical.pin, all.pin2)%>%
mutate(unique_id = paste0("C",Code,"_", sub_id))%>%
select(-sub_id)
unique(pin$Code)
uc<-read.csv("../output/unit_costs/Afghanistan_adjusted_uc_2020.csv", stringsAsFactors = F)%>%
mutate(location_name = "Afghanistan")
for(i in all.locs[2:114]){
uc<-bind_rows(uc, read.csv(paste0("../output/unit_costs/",i,"_adjusted_uc_2020.csv"), stringsAsFactors = F)%>%
mutate(location_name = i))
}
cost<-left_join(pin, uc)%>%
mutate(cost = adjusted_uc*pin)%>%
group_by(Code, group, year_id, Intervention, location_name)%>%
summarise(cost = sum(cost))%>%
spread(group, cost)%>%
rename(Adjusted.cost = Adjusted,
Baseline.cost = Baseline)%>%
mutate(Incremental.cost = Adjusted.cost - Baseline.cost)
WB<-read.csv("../new_inputs/country_groupings.csv", stringsAsFactors = F)%>%
select(iso3, location_gbd, wb2021)%>%
rename(location_name = location_gbd)%>%
left_join(., read.csv("../new_inputs/HS_123 revised.csv", stringsAsFactors = F)%>%
select(ISO3, HSP)%>%
rename(iso3 = ISO3))%>%
mutate(HSP = gsub(" ", "", HSP))%>%
filter(HSP!="NA")
#Add WB2023 class
class<-read_excel("../new_inputs/CLASS.xlsx")%>%
select(Code, `Income group`)%>%
rename(iso3 = Code,
wb2023 = `Income group`)%>%
mutate(wb2023 = ifelse(wb2023=="High income", "HIC", wb2023),
wb2023 = ifelse(wb2023=="Low income", "LIC", wb2023),
wb2023 = ifelse(wb2023=="Lower middle income", "LMIC", wb2023),
wb2023 = ifelse(wb2023=="Upper middle income", "UMIC", wb2023),
wb2023 = ifelse(iso3=="VEN", "UMIC", wb2023))
WB<-left_join(WB, class)
exclude<-c("Turkey", "Vanuatu", "Maldives", "Moldova")
##By HSP##
df<-left_join(cost, deaths.averted)%>%
left_join(., dalys.averted)%>%
left_join(.,WB)%>%
filter(location_name %!in% exclude)%>%
group_by(HSP, year_id, Code, Intervention)%>%
summarise(Baseline.cost = sum(Baseline.cost),
Adjusted.cost = sum(Adjusted.cost),
Incremental.cost = sum(Incremental.cost),
#Deaths.Baseline = sum(Deaths.Baseline),
#Deaths.Adjusted = sum(Deaths.Adjusted),
Deaths.avert = sum(Deaths.avert),
DALYS.Baseline = sum(DALYS.Baseline),
DALYS.Adjusted = sum(DALYS.Adjusted),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(discount.rate = ((1-0.05)^(year_id-2022)),
discount.rate = ifelse(year_id<2023,1,discount.rate),
Baseline.cost = (Baseline.cost*discount.rate),
Adjusted.cost = (Adjusted.cost*discount.rate),
Incremental.cost = (Incremental.cost*discount.rate),
DALYS.Baseline = (DALYS.Baseline*discount.rate),
DALYS.Adjusted = (DALYS.Adjusted*discount.rate),
DALYS.avert = (DALYS.avert*discount.rate)
)%>%na.omit()%>%
group_by(HSP, Code, Intervention)%>%
summarise(Incremental.cost = sum(Incremental.cost),
Deaths.avert = sum(Deaths.avert),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(Incremental.cost = ifelse(Deaths.avert==0, 0, Incremental.cost),
ICER = Incremental.cost/DALYS.avert)
##
unique(df$HSP)
write.csv(df, "figures/HLI_CEA_HSP.csv", row.names = F)
##By WB Class##
df<-left_join(cost, deaths.averted)%>%
left_join(., dalys.averted)%>%
left_join(.,WB)%>%
filter(location_name %!in% exclude)%>%
group_by(wb2023, year_id, Code, Intervention)%>%
summarise(Baseline.cost = sum(Baseline.cost),
Adjusted.cost = sum(Adjusted.cost),
Incremental.cost = sum(Incremental.cost),
#Deaths.Baseline = sum(Deaths.Baseline),
#Deaths.Adjusted = sum(Deaths.Adjusted),
Deaths.avert = sum(Deaths.avert),
DALYS.Baseline = sum(DALYS.Baseline),
DALYS.Adjusted = sum(DALYS.Adjusted),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(discount.rate = ((1-0.05)^(year_id-2022)),
discount.rate = ifelse(year_id<2023,1,discount.rate),
Baseline.cost = (Baseline.cost*discount.rate),
Adjusted.cost = (Adjusted.cost*discount.rate),
Incremental.cost = (Incremental.cost*discount.rate),
DALYS.Baseline = (DALYS.Baseline*discount.rate),
DALYS.Adjusted = (DALYS.Adjusted*discount.rate),
DALYS.avert = (DALYS.avert*discount.rate)
)%>%na.omit()%>%
group_by(wb2023, Code, Intervention)%>%
summarise(Incremental.cost = sum(Incremental.cost),
Deaths.avert = sum(Deaths.avert),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(Incremental.cost = ifelse(Deaths.avert==0, 0, Incremental.cost),
ICER = Incremental.cost/DALYS.avert)
##
unique(df$wb2023)
write.csv(df, "figures/HLI_CEA_WBclass.csv", row.names = F)
View(df)
#in 2050
df<-left_join(cost, deaths.averted)%>%
left_join(., dalys.averted)%>%
left_join(.,WB)%>%
filter(location_name %!in% exclude)%>%
group_by(wb2023, year_id, Code, Intervention)%>%
summarise(Baseline.cost = sum(Baseline.cost),
Adjusted.cost = sum(Adjusted.cost),
Incremental.cost = sum(Incremental.cost),
#Deaths.Baseline = sum(Deaths.Baseline),
#Deaths.Adjusted = sum(Deaths.Adjusted),
Deaths.avert = sum(Deaths.avert),
DALYS.Baseline = sum(DALYS.Baseline),
DALYS.Adjusted = sum(DALYS.Adjusted),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(discount.rate = ((1-0.05)^(year_id-2022)),
discount.rate = ifelse(year_id<2023,1,discount.rate),
Baseline.cost = (Baseline.cost*discount.rate),
Adjusted.cost = (Adjusted.cost*discount.rate),
Incremental.cost = (Incremental.cost*discount.rate),
DALYS.Baseline = (DALYS.Baseline*discount.rate),
DALYS.Adjusted = (DALYS.Adjusted*discount.rate),
DALYS.avert = (DALYS.avert*discount.rate)
)%>%na.omit()%>%
group_by(wb2023, Code, Intervention, year)%>%
summarise(Incremental.cost = sum(Incremental.cost),
Deaths.avert = sum(Deaths.avert),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(Incremental.cost = ifelse(Deaths.avert==0, 0, Incremental.cost),
ICER = Incremental.cost/DALYS.avert)
#in 2050
df<-left_join(cost, deaths.averted)%>%
left_join(., dalys.averted)%>%
left_join(.,WB)%>%
filter(location_name %!in% exclude)%>%
group_by(wb2023, year_id, Code, Intervention)%>%
summarise(Baseline.cost = sum(Baseline.cost),
Adjusted.cost = sum(Adjusted.cost),
Incremental.cost = sum(Incremental.cost),
#Deaths.Baseline = sum(Deaths.Baseline),
#Deaths.Adjusted = sum(Deaths.Adjusted),
Deaths.avert = sum(Deaths.avert),
DALYS.Baseline = sum(DALYS.Baseline),
DALYS.Adjusted = sum(DALYS.Adjusted),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(discount.rate = ((1-0.05)^(year_id-2022)),
discount.rate = ifelse(year_id<2023,1,discount.rate),
Baseline.cost = (Baseline.cost*discount.rate),
Adjusted.cost = (Adjusted.cost*discount.rate),
Incremental.cost = (Incremental.cost*discount.rate),
DALYS.Baseline = (DALYS.Baseline*discount.rate),
DALYS.Adjusted = (DALYS.Adjusted*discount.rate),
DALYS.avert = (DALYS.avert*discount.rate)
)%>%na.omit()%>%
group_by(wb2023, Code, Intervention, year_id)%>%
summarise(Incremental.cost = sum(Incremental.cost),
Deaths.avert = sum(Deaths.avert),
DALYS.avert = sum(DALYS.avert)
)%>%
mutate(Incremental.cost = ifelse(Deaths.avert==0, 0, Incremental.cost),
ICER = Incremental.cost/DALYS.avert)
View(df)
write.csv(df%>%filter(year_id==2050), "figures/HLI_CEA_WB_2050.csv", row.names = F)
View(df)
